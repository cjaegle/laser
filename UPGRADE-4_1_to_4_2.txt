select 'This is the auto-run upgrade script that converts the database from KB+ 4.1 to KB+ 4.2';

select 'Remove all occurrences of gokb namespace identifiers';

delete identifier_occurrence
from identifier_occurrence
join identifier on io_canonical_id = id_id 
join identifier_namespace on id_ns_fk = idns_id
where idns_ns = 'gokbtitleid';

select 'Remove all of gokb namespace identifiers';

delete identifier from identifier join identifier_namespace on id_ns_fk = idns_id where idns_ns = 'gokbtitleid';

select 'Remove all titles without a package and without identifiers';

delete from title_instance
where not exists ( select tipp_id from title_instance_package_platform where tipp_ti_fk = ti_id ) 
      and not exists ( select io_id from identifier_occurrence where io_ti_fk = ti_id )


