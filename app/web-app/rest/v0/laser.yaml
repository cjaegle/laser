---
swagger: '2.0'
info:
  version: 0.1
  title: LAS:eR API
  description: First scratch
  contact: david.klober@hbz-nrw.de

#basePath: /demo/api/v0 # development
basePath: /api/v0 # prod
schemes:
  - http

paths:

  /document:
    get:
      summary: Find document by identifier
      description: >
        Supported are queries by following identifiers: *id* and *uuid*
      parameters:
        $ref: "#definitions/PathParameters"
      produces:
        - application/*
      responses:
        200:
          description: OK
        400:
          description: Invalid or missing identifier
        401:
          description: Request is not authorized
        404:
          description: Valid request, but document not found
        501:
          description: Request is not implemented

  /license:
    get:
      summary: Find license by identifier
      description: >
        Supported are queries by following identifiers: *id* and *impId*
      parameters:
        $ref: "#definitions/PathParameters"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/License"
        400:
          description: Invalid or missing identifier
          example:
        401:
          description: Request is not authorized
        404:
          description: Valid request, but license not found
        501:
          description: Request is not implemented

  /organisation:
    get:
      summary: Find organisation by identifier
      description: >
        Supported are queries by following identifiers: *id*, *impId* and *shortcode*
      parameters:
        $ref: "#definitions/PathParameters"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/Organisation"
        400:
          description: Invalid or missing identifier
        401:
          description: Request is not authorized
        404:
          description: Valid request, but organisation not found
        501:
          description: Request is not implemented

  /package:
    get:
      summary: Find packge by identifier
      description: >
        Supported are queries by following identifiers: *id*, *identifier* and *impId*
      parameters:
        $ref: "#definitions/PathParameters"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/Package"
        400:
          description: Invalid or missing identifier
          example:
        401:
          description: Request is not authorized
        404:
          description: Valid request, but license not found
        501:
          description: Request is not implemented

  /subscription:
    get:
      summary: Find subscription by identifier
      description: >
        Supported are queries by following identifiers: *id*, *identifier* and *impId*
      parameters:
        $ref: "#definitions/PathParameters"
      produces:
        - application/json
      responses:
        200:
          description: OK
          schema:
            $ref: "#/definitions/Subscription"
        400:
          description: Invalid or missing identifier
        401:
          description: Request is not authorized
        404:
          description: Valid request, but subscription not found
        501:
          description: Request is not implemented

definitions:

  Address:
    type: object
    properties:
      id:
        type: integer
        example: 761
      street1:
        type: string
        example: "Jülicher Straße"
      street2:
        type: string
        example: "6"
      pob:
        type: string
        example: "270451"
      zipcode:
        type: string
        example: "50674"
      city:
        type: string
        example: "Köln"
      state:
        type: string
        example: "Nordrhein-Westfalen"
      country:
        type: string
        example: "Deutschland"
      type:
        type: string
        description: Mapping RefdataCategory "AddressType"
        enum:
          ["Postal address", "Billing address", "Delivery address"]
        example: "Postal address"

  Cluster:
    type: object
    properties:
      id:
        type: integer
        example: 37
      definition:
        type: string
      name:
        type: string
      organisations: # mapping attr orgs
        type: array
        items:
          $ref: "#/definitions/OrganisationStub" # resolved OrgRole
      persons: # mapping attr prsLinks
        type: array
        items:
          $ref: "#/definitions/Person" # resolved PersonRole

  ClusterStub:
    type: object
    properties:
      id:
        type: integer
        example: 38
      definition:
        type: string
      name:
        type: string

  Contact:
    type: object
    properties:
      id:
        type: integer
        example: 2419
      category: # mapping attr contentType
        type: string
        description: Mapping RefdataCategory "ContactContentType"
        enum:
          ["Mail", "Phone", "Fax"]
        example: "Mail"
      content:
        type: string
        example: "info-hbz@hbz-nrw.de"
      type:
        type: string
        description: Mapping RefdataCategory "ContactType"
        enum:
          ["Job-related", "Personal"]
        example: "Job-related"

  CostItem:
    type: object
    properties:
      id:
        type: integer
        example: 997
      billingCurrency:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "EUR - Euro Member Countries"
      costDescription:
        type: string
      costInBillingCurrency:
        type: double
        example: 2523.16
      costInLocalCurrency:
        type: double
        example: 1871.10
      costItemCategory:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "Price"
      costItemElement:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "Content"
      costItemStatus:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "Actual"
      dateCreated:
        type: string
        format: date
      datePaid:
        type: string
        format: date
      endDate:
        type: string
        format: date
      includeInSubscription:
        type: String
        description: Could be boolean
      invoice:
        $ref: "#/definitions/Invoice"
      issueEntitlement:
        $ref: "#/definitions/IssueEntitlement"
      lastUpdated:
        type: string
        format: date
      order:
        $ref: "#/definitions/Order"
      owner:
        $ref: "#/definitions/OrganisationStub"
      package: # mapping attr subPkg
        $ref: "#/definitions/PackageStub" # resolved subscriptionPackages
      reference:
        type: string
      sub:
        $ref: "#/definitions/SubscriptionStub"
      startDate:
        type: string
        format: date
      taxCode:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "On Invoice"

  Document:
    type: object
    properties:
      id:
        type: integer
        example: 7751
      filename:
        type: string
        example: "springer_2015.csv"
      mimetype:
        type: string
        example: "text/csv"
      title:
        type: string
        example: "Übersicht 2015"
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
        example: "General"
      uuid:
        type: string
        example: "70d4ef8a-71b9-4b39-b339-9f3773c29b26"

  Identifier:
    type: object
    properties:
      namespace:
        type: string
        example: "ISIL"
      value:
        type: string
        example: "DE-605"

  Invoice:
    type: object
    properties:
      id:
        type: integer
        example: 1026
      dateOfPayment:
        type: string
        format: date
      dateOfInvoice:
        type: string
        format: date
      datePassedToFinance:
        type: string
        format: date
      endDate:
        type: string
        format: date
      invoiceNumber:
        type: string
        example: "0816-Bestellung"
      owner:
        $ref: "#/definitions/OrganisationStub"
      startDate:
        type: string
        format: date

  IssueEntitlement:
    type: object
    properties:
      id:
        type: integer
        example: 21586
      accessStartDate:
        type: string
        format: date
      accessEndDate:
        type: string
        format: date
      coreStatusStart:
        type: string
        format: date
      coreStatusEnd:
        type: string
        format: date
      coreStatus:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      coverageDepth:
        type: string
      coverageNote:
        type: string
      endDate:
        type: string
        format: date
      endVolume:
        type: string
      endIssue:
        type: string
      embargo:
        type: string
      ieReason:
        type: string
      medium:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      startVolume:
        type: string
      startIssue:
        type: string
      startDate:
        type: string
        format: date
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      subscription:
        $ref: "#/definitions/SubscriptionStub"
      tipp:
        $ref: "#/definitions/TitleInstancePackagePlatform"

  License:
    type: object
    properties:
      id:
        type: integer
        example: 111
      contact:
        type: string
      dateCreated:
        type: string
        format: date
      documents:
        type: array
        items:
          $ref: "#/definitions/Document" # resolved DocContext
      endDate:
        type: string
        format: date
      impId:
        type: string
      incomingLinks:
        type: array
        items:
          $ref: "#/definitions/Link"
      isPublic:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      lastmod:
        type: string
        format: date
      lastUpdated:
        type: string
        format: date
      licenseCategory:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      licenseUrl:
        type: string
      licensorRef:
        type: string
      licenseeRef:
        type: string
      licenseStatus:
        type: string
      licenseType:
        type: string
      noticePeriod:
        type: string
      onixplLicense:
        $ref: "#/definitions/OnixplLicense"
      organisations: # mapping attr orgRelations
        type: array
        items:
          $ref: "#/definitions/OrganisationRole" # resolved OrgRole
      outgoingLinks:
        type: array
        items:
          $ref: "#/definitions/Link"
      packages:
        type: array
        items:
          $ref: "#/definitions/PackageStub"
      persons: # mapping attr prsLinks
        type: array
        items:
          $ref: "#/definitions/Person" # resolved PersonRole
      properties: # mapping attr customProperties
        type: array
        items:
          $ref: "#/definitions/Property"
      reference:
        type: string
      sortableReference:
        type: string
      startDate:
        type: string
        format: date
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      subscriptions:
        type: array
        items:
          $ref: "#/definitions/SubscriptionStub"
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []

        #result.incomingLinks        = exportHelperService.resolveLinks(lic.incomingLinks) // com.k_int.kbplus.Link
        #result.outgoinglinks        = exportHelperService.resolveLinks(lic.outgoinglinks) // com.k_int.kbplus.Link


  LicenseStub:
    type: object
    properties:
      id:
        type: integer
        example: 112
      contact:
        type: string
      licenseUrl:
        type: string
      reference:
       type: string

  Link:
    type: object
    properties:
      id:
        type: integer
        example: 4483
      fromLic:
        $ref: "#definitions/LicenseStub"
      isSlaved:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      toLic:
        $ref: "#definitions/LicenseStub"
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []

  OnixplLicense:
    type: object
    properties:
      id:
        type: integer
        example: 376
      document: # mapping attr doc
        $ref: "#definitions/Document"
      lastmod:
        type: string
        format: date
        example: "2016-05-10T13:18:47Z"
      title:
        type: string
#      licenses:
#        type: array
#        items:
#          $ref: "#/definitions/LicenseStub"

  Order:
    type: object
    properties:
      id:
        type: integer
        example: 9605
      orderNumber:
        type: string
        example: "0816-Bestellung"
      owner:
        $ref: "#/definitions/OrganisationStub"

  Organisation:
    type: object
    properties:
      id:
        type: integer
        example: 437
      addresses:
        type: array
        items:
          $ref: "#/definitions/Address"
      comment:
        type: string
      contacts:
        type: array
        items:
          $ref: "#/definitions/Contact"
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      impId:
        type: string
      name:
        type: string
        example: "Hochschulbibliothekszentrum NRW"
      persons: # mapping attr prsLinks
        type: array
        items:
          $ref: "#/definitions/Person" # resolved PersonRole
      properties: # mapping attr customProperties and privateProperties
        type: array
        items:
          $ref: "#/definitions/Property"
      scope:
        type: string
      sector:
        type: string
        description: Mapping RefdataCategory "OrgSector"
        enum:
          ["Higher Education", "Publisher"]
        example: "Higher Education"
      shortcode:
        type: string
        example: "Hochschulbibliothekszentrum_NRW"
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      type:
        type: string
        description: Mapping RefdataCategory "OrgType"
        enum:
          ["Consortium", "Institution", "Other"]
        example: "Institution"

  OrganisationStub:
    type: object
    properties:
      id:
        type: integer
        example: 1781
      name:
        type: string
        example: "Hochschulbibliothekszentrum NRW"
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      impId:
        type: string
      shortcode:
        type: string
        example: "Hochschulbibliothekszentrum_NRW"

  OrganisationRole:
    properties:
      id:
        type: integer
        example: 653
      cluster:
        $ref: "#/definitions/ClusterStub"
        description: |
          Exclusive with license, organisation, package, subscription and title
      endDate:
        type: string
        format: date
        example: "2011-08-31T23:55:59Z"
      license:
        $ref: "#/definitions/LicenseStub"
        description: |
          Exclusive with cluster, organisation, package, subscription and title
      organisation:
        $ref: "#/definitions/OrganisationStub"
        description: |
          Exclusive with cluster, license, package, subscription and title
      package:
        $ref: "#/definitions/PackageStub"
        description: |
          Exclusive with cluster, license, organisation, subscription and title
      roleType:
        type: string
        description: Mapping RefdataCategory "Organisational Role"
        enum:
          []
      startDate:
        type: string
        format: date
        example: "2011-03-01T08:00:00Z"
      subscription:
        $ref: "#/definitions/SubscriptionStub"
        description: |
          Exclusive with cluster, license, organisation, package and title
      title:
        $ref: "#/definitions/TitleStub"
        description: |
          Exclusive with cluster, license, organisation, package and subscription

  Package:
    type: object
    properties:
      id:
        type: integer
        example: 918
      autoAccept:
        type: string
      breakable:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      cancellationAllowances:
        type: string
      consistent:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      dateCreated:
        type: string
        format: date
        example: "2011-01-01T11:12:31"
      documents:
        type: array
        items:
          $ref: "#/definitions/Document" # resolved DocContext
      endDate:
        type: string
        format: date
      fixed:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      forumId:
        type: string
      identifier:
        type: string
        example: "5d83bbbe-2a26-4eef-8708-6d6b86fd8453"
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      impId:
        type: string
        example: "e6b41905-f1aa-4d0c-8533-e39f30220f65"
      isPublic:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      lastUpdated:
        type: string
        format: date
      license:
        $ref: "#/definitions/LicenseStub"
      name:
        type: string
      nominalPlatform:
        $ref: "#/definitions/Platform"
      organisations: # mapping attr orgs
        type: array
        items:
          $ref: "#/definitions/OrganisationRole"
      packageListStatus:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      packageScope:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      packageStatus:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      packageType:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      persons: # mapping attr prsLinks
        type: array
        items:
          $ref: "#/definitions/Person" # resolved PersonRole
      sortName:
        type: string
      startDate:
        type: string
        format: date
      subscriptions:
        type: array
        items:
          $ref: "#/definitions/SubscriptionStub" # resolved subscriptionPackages
        description: TODO
      tipps:
        type: array
        items:
          $ref: "#/definitions/TitleInstancePackagePlatform"
      vendorURL:
        type: string

  PackageStub:
    type: object
    properties:
      id:
        type: integer
        example: 75
      identifier:
        type: string
        example: "04bf5766-bf45-4b9e-afe1-d89de46f6c66"
      name:
        type: string
      vendorURL:
        type: string

  Platform:
    type: object
    properties:
      id:
        type: integer
        example: 621
      dateCreated:
        type: string
      impId:
        type: string
        example: "9d5c918a-851f-4639-a6a1-e2dd124c2e02"
      lastUpdated:
        type: string
      name:
        type: string
      normname:
        type: string
      primaryUrl:
        type: string
      provenance:
        type: string
      serviceProvider:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      softwareProvider:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []

  PlatformStub:
    type: object
    properties:
      id:
        type: integer
        example: 622
      name:
        type: string
      normname:
        type: string

  #valid
  Person:
    type: object
    properties:
      id:
        type: integer
        example: 1019
      addresses:
        type: array
        items:
          $ref: "#/definitions/Address"
      contacts:
        type: array
        items:
          $ref: "#/definitions/Contact"
      firstName:
        type: string
        example: "Berta"
      gender:
        type: string
        description: Mapping RefdataCategory "Gender"
        enum:
          ["Female", "Male"]
        example: "Female"
      isPublic:
        type: string
        description: Mapping RefdataCategory "YN"
        enum:
          ["Yes", "No"]
        example: "Yes"
      lastName:
        type: string
        example: "Bauhaus"
      middleName:
        type: string
      properties: # mapping attr privateProperties
        type: array
        items:
          $ref: "#/definitions/Property"
      roles:
        type: array
        items:
          $ref: "#/definitions/PersonRole"

  PersonRole:
    type: object
    properties:
      id:
        type: integer
        example: 29013
      cluster:
        description: |
          Exclusive with license, organisation, package, subscription and title
        $ref: "#/definitions/ClusterStub"
      endDate:
        type: string
        format: date
        example: "2016-12-31T23:00:00Z"
      functionType:
        type: string
        description: |
          Exclusive with responsibilityType |
          Mapping RefdataCategory "Person Function"
        enum:
          ["General contact person"]
        example: "General contact person"
      license:
        description: |
          Exclusive with cluster, organisation, package, subscription and title
        $ref: "#/definitions/LicenseStub"
      organisation:
        description: |
          Exclusive with cluster, license, package, subscription and title
        $ref: "#/definitions/OrganisationStub"
      package:
        description: |
          Exclusive with cluster, license, organisation, subscription and title
        $ref: "#/definitions/PackageStub"
      responsibilityType:
        type: string
        description: |
          Exclusive with functionType |
          Mapping RefdataCategory "Person Responsibility"
        enum:
          ["Specific licence editor", "Specific subscription editor", "Specific package editor", "Specific cluster editor", "Specific title editor"]
        example: "Specific licence editor"
      startDate:
        type: string
        format: date
        example: "2016-01-01T00:00:00Z"
      subscription:
        description: |
          Exclusive with cluster, license, organisation, package and title
        $ref: "#/definitions/SubscriptionStub"
      title:
        description: |
          Exclusive with cluster, license, organisation, package and subscription
        $ref: "#/definitions/TitleStub"

  Property:
    type: object
    properties:
      id:
        type: integer
        example: 7083
      description: # mapping attr descr
        type: string
      name:
        type: string
      note:
        type: string
      tenant:
        $ref: "#/definitions/OrganisationStub"
      value: # mapping attr stringValue, intValue, decValue, refValue
        type: string

  Subscription:
    type: object
    properties:
      id:
        type: integer
        example: 816
      cancellationAllowances:
        type: string
      dateCreated:
        type: string
        format: date
      documents:
        type: array
        items:
          $ref: "#/definitions/Document" # resolved DocContext
      endDate:
        type: string
        format: date
      identifier:
        type: string
        example: "1038ac38-eb21-4bf0-ab7e-fe8b8ba34b6c"
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      impId:
        type: string
        example: "ff74dd15-e27f-48a2-b2d7-f02389e62639"
      instanceOf:
        $ref: "#/definitions/SubscriptionStub"
      isPublic:
        type: string
        description: Mapping RefdataCategory "YN"
        enum:
          ["Yes", "No"]
      issueEntitlements:
        type: array
        items:
          $ref: "#/definitions/IssueEntitlement"
      isSlaved:
        type: string
        description: Mapping RefdataCategory "YN"
        enum:
          ["Yes", "No"]
      lastUpdated:
        type: string
        format: date
      license: # mapping owner
        $ref: "#/definitions/LicenseStub"
      manualRenewalDate:
        type: string
        format: date
      name:
        type: string
      noticePeriod:
        type: string
      organisations: # mapping attr orgRelations
        type: array
        items:
          $ref: "#/definitions/OrganisationRole"
      persons: # mapping attr prsLinks
        type: array
        items:
          $ref: "#/definitions/Person" # resolved PersonRole
      properties: # mapping attr customProperties
        type: array
        items:
          $ref: "#/definitions/Property"
      startDate:
        type: string
        format: date
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []

  SubscriptionStub:
    type: object
    properties:
      id:
        type: integer
        example: 91
      identifier:
        type: string
        example: "1038ac38-eb21-4bf0-ab7e-fe8b8ba34b6c"
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      name:
        type: string

  Title:
    type: object
    properties:
      id:
        type: integer
        example: 39156
      dateCreated:
        type: string
        format: date
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      impId:
        type: string
        example: "daccb411-e7c6-4048-addf-1d2ccf35817f"
      keyTitle:
        type: string
        example: "Das gute Buch"
      lastUpdated:
        type: string
        format: date
      normtitle:
        type: string
        example: "Das_gute_Buch"
      sortTitle:
        type: string
        example: "Das_gute_Buch"
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      title:
        type: string
        example: "Das gute Buch"
      type:
        type: string
        description: Mapping RefdataCategory
        enum:
          []

  TitleStub:
    type: object
    properties:
      id:
        type: integer
        example: 39157
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"
      title:
        type: string
        example: "Das gute Buch"
      normtitle:
        type: string
        example: "Das_gute_Buch"

  TitleInstancePackagePlatform:
    type: object
    description: TODO
    properties:
      id:
        type: integer
        example: 51254
      accessStartDate:
        type: string
      accessEndDate:
        type: string
      coreStatusStart:
        type: string
      coreStatusEnd:
        type: string
      coverageDepth:
        type: string
      coverageNote:
        type: string
      delayedOA:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      derivedFrom:
        $ref: "#/definitions/TitleInstancePackagePlatformStub"
      embargo:
        type: string
      endDate:
        type: string
      endVolume:
        type: string
      endIssue:
        type: string
      hostPlatformURL:
        type: string
      hybridOA:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      impId:
        type: string
        example: "c920188c-a7f8-54f6-80b5-e0161df3d360"
      masterTipp:
        $ref: "#/definitions/TitleInstancePackagePlatformStub"
      option:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      package:
        $ref: "#/definitions/PackageStub"
      payment:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      platform:
        $ref: "#/definitions/PlatformStub"
      rectype:
        type: string
      startDate:
        type: string
      startIssue:
        type: string
      startVolume:
        type: string
      status:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      statusReason:
        type: string
        description: Mapping RefdataCategory
        enum:
          []
      subscription:
        $ref: "#/definitions/SubscriptionStub"
      title:
        $ref: "#/definitions/TitleStub"

  TitleInstancePackagePlatformStub:
    type: object
    description: TODO
    properties:
      id:
        type: integer
        example: 51255
      identifiers: # mapping attr ids
        type: array
        items:
          $ref: "#/definitions/Identifier"

  PathParameters:
    - in: query
      name: q
      required: true
      type: string
      description: Identifier for this query
    - in: query
      name: v
      required: true
      type: string
      description: Value for this query
    - in: header
      name: Authorization
      required: true
      type: string
      description: hmac-sha256 generated auth header